# 一、简介

基于QT的c++开发，这是我的第一个项目，关于网络聊天室的创建，其中包含了客户端和服务端的通讯，以及与数据库的连接，文中标注了很多的注释，如有不规范或不当的地方还请海涵。本项目后期会增加其他内容，不定时更新，会修复已存在的bug，本人能力水平有限，还希望读者能提出宝贵的意见，包括代码的改进以及bug的修复。谢谢！

# 二、关于UI方面的设计

具体界面的设计可以下载**.ui-file**文件夹，里面包含3个ui文件，操作简单，注意一些button的属性即可。

# 三、关于服务端和客户端的连接

本项目采用的是udp连接，将服务器的端口打开，绑定自身端口号，同时接收来自客户端的信息，接收到客户端的信息之后，将收到的客户端信息通过广播的方式发送给该网段下的所有已经和服务端建立连接的用户。同样，将客户端的端口打开，绑定自身的端口号，同时接收来自服务端的信息。

images文件夹存放的是用户聊天界面的图片，在该项目中加载该文件夹。

本项目通过设定一个枚举，其中三个值依次表示收到的信号是：**用户之间信息的发送、用户登陆、用户退出**。在**widget.cpp**和**server.cpp**中对这三个信号做不同的处理。

```c++
enum MsgType{Msg,UsrEnter,UsrLeft};
```

**widget.ui**和**widget.cpp**是对用户聊天界面的设计，包括了一些基本功能：用户上线提示，下线提示，在线用户有哪些，字体的设计以及发送内容的设计等。

**login.ui**和**login.cpp**是用户一开始的登陆界面的设计，当点击登录后就会通过widget.cpp中的sndMsg()函数将信号传递给服务端，再通过服务端传递到与他连接的所有客户端。

**server.ui**和**server.cpp**是服务端的界面设计及实现，当点击开启服务器后，用户们才能够进行通讯（用户们之间的通讯都是通过将数据传递给服务端，再从服务端传递给各个用户），并且在服务端界面上的**QTableWidget** 控件显示了所有在线用户，由于后加入聊天的用户的聊天界面可能不显示 在他之前加入的用户名字，所以我在本项目对**QTableWidget** 使用了行读取，每次有新用户登陆时将所有已经在线的用户信息发送给所有的已连接的用户。具体见**server.cpp**文件中注释。

# 四、关于QT与MYSQL的连接

首先我们要在MySQL的安装目录中把**libmysql.dll**复制到QT安装目录的**bin**目录下，然后在**.pro**文件中加入**sql**

```c++
QT  += core gui network sql
```

在widget.h的头文件中加入头文件以及数据库初始化的函数，并且在widget.cpp的构造函数中实现初始化。每次用户进行聊天时，都会将用户名，用户聊天时间以及聊天内容传入到我们的数据库中，本项目我是放在wechat库下的record的表中。具体见widget.cpp中的**connect_mysql()**函数。

```c++
//加入头文件
#include<QtSql>
#include<QSqlDatabase>
```

# 五、本文存在的缺陷（BUG）

## 1.可以实现对同一个用户的重复登陆，但这不是我们想要的

## 2.数据库的写入有问题（变量数据写入数据库，见widget.cpp的178行）